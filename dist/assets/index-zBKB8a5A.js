import{E as ne,V as X,a as se,B as ie,F as O,M as re,b as ce,S as le,C as ae,P as he,W as de,A as ue,D as fe,c as me}from"./three-Cd3cFUtO.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();var pe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ke(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Y={exports:{}};(function(c,t){(function(e,o){c.exports=o()})(pe,function(){var e=function(){function o(u){return s.appendChild(u.dom),u}function n(u){for(var f=0;f<s.children.length;f++)s.children[f].style.display=f===u?"block":"none";r=u}var r=0,s=document.createElement("div");s.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",s.addEventListener("click",function(u){u.preventDefault(),n(++r%s.children.length)},!1);var h=(performance||Date).now(),k=h,l=0,w=o(new e.Panel("FPS","#0ff","#002")),y=o(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var i=o(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:s,addPanel:o,showPanel:n,begin:function(){h=(performance||Date).now()},end:function(){l++;var u=(performance||Date).now();if(y.update(u-h,200),u>k+1e3&&(w.update(1e3*l/(u-k),100),k=u,l=0,i)){var f=performance.memory;i.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return u},update:function(){h=this.end()},domElement:s,setMode:n}};return e.Panel=function(o,n,r){var s=1/0,h=0,k=Math.round,l=k(window.devicePixelRatio||1),w=80*l,y=48*l,i=3*l,u=2*l,f=3*l,d=15*l,m=74*l,p=30*l,g=document.createElement("canvas");g.width=w,g.height=y,g.style.cssText="width:80px;height:48px";var a=g.getContext("2d");return a.font="bold "+9*l+"px Helvetica,Arial,sans-serif",a.textBaseline="top",a.fillStyle=r,a.fillRect(0,0,w,y),a.fillStyle=n,a.fillText(o,i,u),a.fillRect(f,d,m,p),a.fillStyle=r,a.globalAlpha=.9,a.fillRect(f,d,m,p),{dom:g,update:function(b,S){s=Math.min(s,b),h=Math.max(h,b),a.fillStyle=r,a.globalAlpha=1,a.fillRect(0,0,w,d),a.fillStyle=n,a.fillText(k(b)+" "+o+" ("+k(s)+"-"+k(h)+")",i,u),a.drawImage(g,f+l,d,m-l,p,f,d,m-l,p),a.fillRect(f+m-l,d,l,p),a.fillStyle=r,a.globalAlpha=.9,a.fillRect(f+m-l,d,l,k((1-b/S)*p))}}},e})})(Y);var we=Y.exports;const ye=ke(we),z=new se(0,0,0,"YXZ"),R=new X,ge={type:"change"},ve={type:"lock"},be={type:"unlock"},B=Math.PI/2;class xe extends ne{constructor(t,e){super(),this.camera=t,this.domElement=e,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=Ee.bind(this),this._onPointerlockChange=Se.bind(this),this._onPointerlockError=Me.bind(this),this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return this.camera}getDirection(t){return t.set(0,0,-1).applyQuaternion(this.camera.quaternion)}moveForward(t){const e=this.camera;R.setFromMatrixColumn(e.matrix,0),R.crossVectors(e.up,R),e.position.addScaledVector(R,t)}moveRight(t){const e=this.camera;R.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(R,t)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function Ee(c){if(this.isLocked===!1)return;const t=c.movementX||c.mozMovementX||c.webkitMovementX||0,e=c.movementY||c.mozMovementY||c.webkitMovementY||0,o=this.camera;z.setFromQuaternion(o.quaternion),z.y-=t*.002*this.pointerSpeed,z.x-=e*.002*this.pointerSpeed,z.x=Math.max(B-this.maxPolarAngle,Math.min(B-this.minPolarAngle,z.x)),o.quaternion.setFromEuler(z),this.dispatchEvent(ge)}function Se(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(ve),this.isLocked=!0):(this.dispatchEvent(be),this.isLocked=!1)}function Me(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}const $=Math.sqrt(3),Pe=.5*($-1),H=(3-$)/6,Q=c=>Math.floor(c)|0,U=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Ce(c=Math.random){const t=Le(c),e=new Float64Array(t).map(n=>U[n%12*2]),o=new Float64Array(t).map(n=>U[n%12*2+1]);return function(r,s){let h=0,k=0,l=0;const w=(r+s)*Pe,y=Q(r+w),i=Q(s+w),u=(y+i)*H,f=y-u,d=i-u,m=r-f,p=s-d;let g,a;m>p?(g=1,a=0):(g=0,a=1);const b=m-g+H,S=p-a+H,M=m-1+2*H,x=p-1+2*H,C=y&255,F=i&255;let A=.5-m*m-p*p;if(A>=0){const L=C+t[F],v=e[L],W=o[L];A*=A,h=A*A*(v*m+W*p)}let I=.5-b*b-S*S;if(I>=0){const L=C+g+t[F+a],v=e[L],W=o[L];I*=I,k=I*I*(v*b+W*S)}let T=.5-M*M-x*x;if(T>=0){const L=C+1+t[F+1],v=e[L],W=o[L];T*=T,l=T*T*(v*M+W*x)}return 70*(h+k+l)}}function Le(c){const e=new Uint8Array(512);for(let o=0;o<512/2;o++)e[o]=o;for(let o=0;o<512/2-1;o++){const n=o+~~(c()*(256-o)),r=e[o];e[o]=e[n],e[n]=r}for(let o=256;o<512;o++)e[o]=e[o-256];return e}class Ae{constructor(t,e=navigator.hardwareConcurrency||4){this.poolSize=e,this.workerConstructor=t,this.workers=[],this.taskQueue=[],this.pendingCallbacks=new Map,this.initWorkers()}initWorkers(){for(let t=0;t<this.poolSize;t++){const e=new this.workerConstructor;e.onmessage=o=>this.handleWorkerResponse(e,o),e.onerror=o=>this.handleWorkerError(e,o),this.workers.push({worker:e,busy:!1})}}handleWorkerResponse(t,e){const o=this.workers.find(n=>n.worker===t);if(o){o.busy=!1;const n=this.taskQueue.shift();n&&this.executeTask(t,n)}if(e.data.type==="chunkGenerated"){const{chunkData:n,callbackId:r}=e.data,s=this.pendingCallbacks.get(r);s&&(s(n),this.pendingCallbacks.delete(r))}}handleWorkerError(t,e){console.error("Worker error:",e);const o=this.workers.find(n=>n.worker===t);o&&(o.busy=!1)}executeTask(t,e){const o=this.workers.find(n=>n.worker===t);o&&(o.busy=!0,t.postMessage({...e.message,callbackId:e.callbackId}))}enqueueTask(t,e){const o=performance.now()+Math.random().toString(36).substring(2);this.pendingCallbacks.set(o,e);const n=this.workers.find(r=>!r.busy);n?this.executeTask(n.worker,{message:t,callbackId:o}):this.taskQueue.push({message:t,callbackId:o})}terminate(){this.workers.forEach(({worker:t})=>t.terminate()),this.workers=[],this.taskQueue=[],this.pendingCallbacks.clear()}}const P=32,K=256,_=32,We=64,_e=[{type:"AIR",color:[0,0,0,0]},{type:"STONE",color:[128,128,128,255]},{type:"DIRT",color:[139,69,19,255]},{type:"GRASS",color:[95,159,53,255]},{type:"WATER",color:[30,144,255,200]},{type:"SNOW",color:[255,255,255,255]}];class De{constructor(t,e){this.chunkX=t,this.chunkZ=e,this.voxels=new Uint8Array(P*K*_),this.mesh=null}getVoxel(t,e,o){const n=e*P*_+o*P+t;return this.voxels[n]}setVoxel(t,e,o,n){const r=e*P*_+o*P+t;this.voxels[r]=n}generate(t){for(let s=0;s<P;s++)for(let h=0;h<_;h++){const k=this.chunkX*P+s,l=this.chunkZ*_+h;let w=1,y=1,i=0;for(let d=0;d<5;d++){const m=k/500*y,p=l/500*y,g=t(m,p);i+=g*w,w*=.1,y*=2}let u=Math.floor(i*35)+150,f;u<120?f=(u-115)*(48/5):u<=180?f=48+(u-120)*(160/60):f=208+(u-180)*(48/5),f=Math.max(0,Math.min(255,Math.floor(f))),i=f;for(let d=0;d<K;d++)if(d<i){let m=1;i>190?d>=i-3?m=5:d>=i-4&&(m=2):d===i-1?m=3:d>=i-4&&(m=2),this.setVoxel(s,d,h,m)}}for(let s=0;s<P;s++)for(let h=0;h<_;h++)for(let k=We;k>=0;k--)this.getVoxel(s,k,h)===0&&this.setVoxel(s,k,h,4)}dispose(){this.mesh&&(this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.mesh=null)}createMesh(){const t=[],e=[],o=[],n=[],r=[],s=[P,K,_];for(let l=0;l<3;l++){const w=(l+1)%3,y=(l+2)%3,i=[0,0,0],u=[0,0,0];u[l]=1;const f=new Int32Array(s[w]*s[y]);for(i[l]=-1;i[l]<s[l];){let d=0;for(i[y]=0;i[y]<s[y];i[y]++)for(i[w]=0;i[w]<s[w];i[w]++){const m=i[l]>=0?this.getVoxel(i[0],i[1],i[2]):0,p=i[l]<s[l]-1?this.getVoxel(i[0]+u[0],i[1]+u[1],i[2]+u[2]):0;f[d++]=m&&!p?m:!m&&p?-p:0}i[l]++,d=0;for(let m=0;m<s[y];m++)for(let p=0;p<s[w];)if(f[d]){const g=f[d];let a=1;for(;p+a<s[w]&&f[d+a]===g;)a++;let b=1;for(;m+b<s[y];){let v=0;for(;v<a&&f[d+v+b*s[w]]===g;)v++;if(v<a)break;b++}i[w]=p,i[y]=m;const S=[0,0,0];S[w]=a;const M=[0,0,0];M[y]=b;const x=t.length/3;t.push(i[0],i[1],i[2]),t.push(i[0]+S[0],i[1]+S[1],i[2]+S[2]),t.push(i[0]+M[0],i[1]+M[1],i[2]+M[2]),t.push(i[0]+S[0]+M[0],i[1]+S[1]+M[1],i[2]+S[2]+M[2]);const C=[0,0,0];g>0?C[l]=1:C[l]=-1,e.push(...C,...C,...C,...C),o.push(0,0,a,0,0,b,a,b);const F=Math.abs(g),A=_e[F].color,I=A[0]/255,T=A[1]/255,L=A[2]/255;for(let v=0;v<4;v++)r.push(I,T,L);g>0?(n.push(x,x+1,x+2),n.push(x+1,x+3,x+2)):(n.push(x,x+2,x+1),n.push(x+1,x+2,x+3));for(let v=0;v<b;++v)for(let W=0;W<a;++W)f[d+W+v*s[w]]=0;p+=a,d+=a}else p++,d++}}const h=new ie;h.setAttribute("position",new O(t,3)),h.setAttribute("normal",new O(e,3)),h.setAttribute("uv",new O(o,2)),h.setAttribute("color",new O(r,3)),h.setIndex(n);const k=new re({vertexColors:!0});return this.mesh=new ce(h,k),this.mesh}}function Ie(c){return new Worker("/assets/chunkWorker-Z0WfiBu5.js",{type:"module",name:c==null?void 0:c.name})}class Te{constructor(t,e){this.chunks={},this.noiseSeed=t,this.scene=e,this.pendingChunks=new Map,this.workerPool=new Ae(Ie,4)}getChunk(t,e){const o=`${t},${e}`;if(!this.chunks[o]){const n=new De(t,e);this.chunks[o]=n,this.pendingChunks.set(o,n),this.workerPool.enqueueTask({chunkX:t,chunkZ:e,noiseSeed:this.noiseSeed},r=>{if(!this.chunks[o])return;n.voxels=new Uint8Array(r.voxels);const s=n.createMesh();s.position.set(t*P,0,e*_),this.scene.add(s),n.mesh=s,this.pendingChunks.delete(o)})}return this.chunks[o]}update(t,e=12){const o=Math.floor(t.x/P),n=Math.floor(t.z/_),r=new Set;for(let s=o-e;s<=o+e;s++)for(let h=n-e;h<=n+e;h++){const k=`${s},${h}`;r.add(k),this.chunks[k]||this.getChunk(s,h)}for(const s in this.chunks)if(!r.has(s)){const h=this.chunks[s];this.pendingChunks.has(s)&&this.pendingChunks.delete(s),this.scene.remove(h.mesh),h.dispose(),delete this.chunks[s]}}dispose(){this.workerPool.terminate();for(const t in this.chunks){const e=this.chunks[t];this.scene.remove(e.mesh),e.dispose()}this.chunks={},this.pendingChunks.clear()}}const q=new le;q.background=new ae(8900331);const E=new he(75,window.innerWidth/window.innerHeight,.1,1e3);E.position.set(16,200,16);const N=new de({antialias:!0});N.setSize(window.innerWidth,window.innerHeight);N.setPixelRatio(window.devicePixelRatio);document.body.appendChild(N.domElement);const ze=new ue(16777215,.7);q.add(ze);const Z=new fe(16777215,.8);Z.position.set(5,10,7.5);q.add(Z);const j=new ye;j.showPanel(0);document.body.appendChild(j.dom);const J=Math.random();Ce(()=>J);const ee=new Te(J,q);ee.update(E.position);const G=new xe(E,document.body),te=document.getElementById("instructions");document.body.addEventListener("click",()=>{G.lock()});G.addEventListener("lock",()=>{te.style.display="none"});G.addEventListener("unlock",()=>{te.style.display="block"});const D={};document.addEventListener("keydown",c=>D[c.code]=!0);document.addEventListener("keyup",c=>D[c.code]=!1);const Re=new me,V=15;function oe(){requestAnimationFrame(oe),j.begin();const c=Re.getDelta();if(G.isLocked){const t=new X;E.getWorldDirection(t),t.y=0,t.normalize();const e=new X().crossVectors(E.up,t).normalize();D.KeyW&&E.position.addScaledVector(t,V*c),D.KeyS&&E.position.addScaledVector(t,-V*c),D.KeyA&&E.position.addScaledVector(e,V*c),D.KeyD&&E.position.addScaledVector(e,-V*c),D.Space&&(E.position.y+=V*c),D.ShiftLeft&&(E.position.y-=V*c)}ee.update(E.position),document.getElementById("camera-position").textContent=`X: ${E.position.x.toFixed(2)} Y: ${E.position.y.toFixed(2)} Z: ${E.position.z.toFixed(2)}`,N.render(q,E),j.end()}oe();
