<!DOCTYPE html>
<html>
<head>
    <title>WebGPU Triangle Test</title>
    <style>
        body { margin: 0; background: #000; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <div id="status" style="position: absolute; top: 10px; left: 10px; color: white;">Testing...</div>
    
    <script type="module">
        async function testWebGPU() {
            const canvas = document.getElementById('canvas');
            const status = document.getElementById('status');
            
            try {
                // Get WebGPU device
                const adapter = await navigator.gpu.requestAdapter();
                const device = await adapter.requestDevice();
                
                // Configure canvas
                const context = canvas.getContext('webgpu');
                context.configure({
                    device: device,
                    format: 'bgra8unorm'
                });
                
                // Simple vertex shader
                const vertexShader = device.createShaderModule({
                    code: `
                        @vertex
                        fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> @builtin(position) vec4<f32> {
                            var pos = array<vec2<f32>, 3>(
                                vec2<f32>( 0.0,  0.5),
                                vec2<f32>(-0.5, -0.5),
                                vec2<f32>( 0.5, -0.5)
                            );
                            return vec4<f32>(pos[vertexIndex], 0.0, 1.0);
                        }
                    `
                });
                
                // Simple fragment shader
                const fragmentShader = device.createShaderModule({
                    code: `
                        @fragment
                        fn fs_main() -> @location(0) vec4<f32> {
                            return vec4<f32>(1.0, 0.0, 0.0, 1.0); // Red
                        }
                    `
                });
                
                // Create render pipeline
                const pipeline = device.createRenderPipeline({
                    layout: 'auto',
                    vertex: {
                        module: vertexShader,
                        entryPoint: 'vs_main'
                    },
                    fragment: {
                        module: fragmentShader,
                        entryPoint: 'fs_main',
                        targets: [{ format: 'bgra8unorm' }]
                    },
                    primitive: {
                        topology: 'triangle-list'
                    }
                });
                
                // Render
                const commandEncoder = device.createCommandEncoder();
                const renderPass = commandEncoder.beginRenderPass({
                    colorAttachments: [{
                        view: context.getCurrentTexture().createView(),
                        clearValue: { r: 0.0, g: 0.0, b: 1.0, a: 1.0 },
                        loadOp: 'clear',
                        storeOp: 'store'
                    }]
                });
                
                renderPass.setPipeline(pipeline);
                renderPass.draw(3);
                renderPass.end();
                
                device.queue.submit([commandEncoder.finish()]);
                
                status.textContent = '✅ WebGPU triangle rendered successfully!';
                
            } catch (error) {
                status.textContent = `❌ Error: ${error.message}`;
                console.error(error);
            }
        }
        
        testWebGPU();
    </script>
</body>
</html>